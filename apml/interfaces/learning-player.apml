# APML Interface: Learning Player Specification
# SSI Learning App v2.1.0
# Version: 2.1.0 (2026-01-18)
# Status: Production-ready

## ============================================================================
## OVERVIEW
## ============================================================================

SPECIFICATION:
  name: "Learning Player Interface"
  purpose: "Main player UI for the 4-phase learning cycle with constellation network"
  source: "packages/player-vue/src/components/LearningPlayer.vue"
  design_system: "Deep Space Constellation"
  version: "2.0.0"
  previous_version: "1.0.0 (Moonlit Dojo)"

DESIGN_PHILOSOPHY:
  name: "Deep Space Constellation"
  evolution: "Evolved from Moonlit Dojo to Deep Space Constellation in January 2026"

  visual_principles:
    - "Deep space gradient background with nebula effects"
    - "Constellation network as primary visual element"
    - "Hero-centric glass pane for text display"
    - "Belt color accent (preserved from Moonlit Dojo)"
    - "Star field for ambient depth"
    - "Phase strip with semantic icons (speaker/mic/eyes)"

  interaction_principles:
    - "Network pans to center on current LEGO (hero node)"
    - "Spatial relationships preserved - 'quiero always up-left of hablar'"
    - "Pinch-zoom and drag-pan for exploration"
    - "Node tap to hear individual LEGOs"
    - "Transport controls in thumb zone (bottom)"

## ============================================================================
## BELT PROGRESSION SYSTEM
## ============================================================================

BELT_SYSTEM:
  description: |
    8 martial arts belts track learner progress through the course.
    Each belt requires completing a certain number of seeds.
    Progress is tracked via highest_completed_seed (1-668).

  thresholds: [0, 8, 20, 40, 80, 150, 280, 400]
  total_seeds: 668

  belts:
    white:
      name: "White"
      seeds_required: 0
      seed_range: "1-7"
      color: "#f5f5f5"
      glow: "rgba(245, 245, 245, 0.2)"

    yellow:
      name: "Yellow"
      seeds_required: 8
      seed_range: "8-19"
      color: "#fbbf24"
      glow: "rgba(251, 191, 36, 0.2)"

    orange:
      name: "Orange"
      seeds_required: 20
      seed_range: "20-39"
      color: "#f97316"
      glow: "rgba(249, 115, 22, 0.2)"

    green:
      name: "Green"
      seeds_required: 40
      seed_range: "40-79"
      color: "#22c55e"
      glow: "rgba(34, 197, 94, 0.2)"

    blue:
      name: "Blue"
      seeds_required: 80
      seed_range: "80-149"
      color: "#3b82f6"
      glow: "rgba(59, 130, 246, 0.2)"

    purple:
      name: "Purple"
      seeds_required: 150
      seed_range: "150-279"
      color: "#8b5cf6"
      glow: "rgba(139, 92, 246, 0.2)"

    brown:
      name: "Brown"
      seeds_required: 280
      seed_range: "280-399"
      color: "#a87848"
      glow: "rgba(168, 120, 72, 0.2)"

    black:
      name: "Black"
      seeds_required: 400
      seed_range: "400-668"
      color: "#d4a853"
      glow: "rgba(212, 168, 83, 0.2)"

  persistence:
    local: "localStorage key: ssi_belt_progress_{courseCode}"
    remote: "Supabase: course_enrollments.highest_completed_seed"
    sync_strategy: "max(local, remote) wins - progress never goes backward"

## ============================================================================
## VISUAL LAYOUT (January 2026)
## ============================================================================

LAYOUT:
  structure: |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    Deep Space Background                            â”‚
    â”‚                    (gradient + nebula + noise)                      â”‚
    â”‚                                                                     â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â”‚              CONSTELLATION NETWORK VIEW                   â”‚   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â”‚         â—‹ â”€â”€â”€â”€â”€â”€ â— â”€â”€â”€â”€â”€â”€ â—‹                              â”‚   â”‚
    â”‚    â”‚        /          \                                       â”‚   â”‚
    â”‚    â”‚       â—‹            â—‹ â†â”€â”€ Hero Node (centered)            â”‚   â”‚
    â”‚    â”‚                     \                                     â”‚   â”‚
    â”‚    â”‚                      â—‹                                    â”‚   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                     â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚    â”‚            HERO TEXT PANE (Glass Effect)                  â”‚   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
    â”‚    â”‚  â”‚  ğŸ”Š  â”‚  ğŸ¤  â”‚  ğŸ”Š  â”‚  ğŸ‘€  â”‚   â† Phase Strip          â”‚â”‚   â”‚
    â”‚    â”‚  â”‚ promptâ”‚speak â”‚voice1â”‚voice2â”‚     (icons)              â”‚â”‚   â”‚
    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â”‚  "I want to speak Italian with you"    â† Known text      â”‚   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â”‚  "Voglio parlare italiano con te"      â† Target (voice_2)â”‚   â”‚
    â”‚    â”‚                                                           â”‚   â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                     â”‚
    â”‚              â®  â–¶ï¸  â­                â† Transport Controls       â”‚
    â”‚                                                                     â”‚
    â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚    Star Field (static distant stars)                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  layers:
    z_0: "Space gradient background"
    z_1: "Space nebula overlay"
    z_2: "Background noise texture"
    z_3: "Static star field"
    z_4: "Constellation network view"
    z_5: "Hero text pane (glass)"
    z_6: "Node hover tooltip"
    z_7: "Transport controls"
    z_8: "Overlays (session complete, consent prompts)"

## ============================================================================
## HERO TEXT PANE
## ============================================================================

HERO_TEXT_PANE:
  description: "Floating glass panel showing current phrase and phase"

  visual:
    background: "Frosted glass effect (backdrop-blur)"
    border: "Subtle belt-colored glow"
    position: "Lower third of screen, over network"

  modes:
    intro_mode:
      display: "Typewriter-style encouraging message"
      elements:
        prefix: "â€º (chevron)"
        message: "Typewriter text animation"
        cursor: "â–Œ (blinking block cursor)"
      triggers: "Item type is 'intro'"

    normal_mode:
      display: "Phase strip + known/target text"
      elements:
        phase_strip: "Horizontal 4-section strip with icons"
        known_text: "Known language text (always visible)"
        target_text: "Target language text (voice_2 only)"

## ============================================================================
## PHASE STRIP
## ============================================================================

PHASE_STRIP:
  description: "Horizontal strip showing 4 phases with semantic icons"
  location: "Top of hero text pane"

  sections:
    prompt:
      icon: "Speaker SVG (ğŸ”Š)"
      label: "Listen to prompt"
      active_style: "Belt-colored glow"

    speak:
      icon: "Microphone SVG (ğŸ¤)"
      label: "Your turn to speak"
      active_style: "Belt-colored glow + timer bar"
      timer: "Linear progress bar showing pause countdown"

    voice_1:
      icon: "Speaker SVG (ğŸ”Š)"
      label: "Native speaker #1"
      active_style: "Belt-colored glow"

    voice_2:
      icon: "Eyes emoji (ğŸ‘€)"
      label: "See the answer"
      active_style: "Belt-colored glow"

  timer_bar:
    location: "Inside mic section when speak phase active"
    style: "Linear fill bar (replaced ring progress)"
    animation: "Width grows from 0% to 100% over pause duration"

## ============================================================================
## PHASE-SPECIFIC UI STATES
## ============================================================================

PHASE_UI_STATES:
  PROMPT:
    phase_strip: "Prompt section highlighted (speaker icon)"
    known_text: "Visible, prominent"
    target_text: "Hidden"
    network: "Hero node centered, subtle glow"

  PAUSE (speak):
    phase_strip: "Speak section highlighted (mic icon) + timer bar"
    known_text: "Visible, slightly dimmed"
    target_text: "Hidden"
    network: "Path nodes begin to highlight"

  VOICE_1:
    phase_strip: "Voice_1 section highlighted (speaker icon)"
    known_text: "Visible"
    target_text: "Hidden"
    network: "Path nodes highlighted with pulse"

  VOICE_2:
    phase_strip: "Voice_2 section highlighted (eyes icon)"
    known_text: "Visible"
    target_text: "Revealed with animation"
    network: "Full path animation (nodes + edges + labels)"

## ============================================================================
## CONSTELLATION NETWORK INTEGRATION
## ============================================================================

NETWORK_INTEGRATION:
  component: "ConstellationNetworkView"
  spec: "apml/interfaces/constellation-network.apml"

  behavior:
    on_item_change: "Pan to center hero node"
    on_voice_phases: "Highlight path through network"
    on_node_tap: "Play target audio for that LEGO"
    on_intro_phase: "Network faded (network-faded class)"

  props_provided:
    nodes: "From usePrebuiltNetworkIntegration"
    edges: "From usePrebuiltNetworkIntegration"
    heroNodeId: "Current LEGO ID"
    currentPath: "Path from phrase decomposition"
    panTransform: "Computed to center hero"
    showPathLabels: "true when voice_2"
    resonatingNodeIds: "Related nodes during voice phases"

## ============================================================================
## TRANSPORT CONTROLS
## ============================================================================

TRANSPORT_CONTROLS:
  location: "Bottom of screen (thumb zone)"
  visibility: "Always visible"

  buttons:
    previous:
      icon: "Skip back (â®)"
      action: "Go to previous item"
      size: "44px touch target"

    play_pause:
      icon: "Play (â–¶) or Pause (â¸)"
      action: "Toggle session playback"
      size: "56px (larger, primary action)"
      color: "Accent red (#c23a3a)"

    next:
      icon: "Skip forward (â­)"
      action: "Skip to next item"
      size: "44px touch target"

## ============================================================================
## INTRO MODE
## ============================================================================

INTRO_MODE:
  description: "Gentle listen prompts between learning rounds"

  display:
    style: "Typewriter animation"
    prefix: "â€º chevron"
    cursor: "â–Œ blinking"
    font: "JetBrains Mono"

  messages:
    examples:
      - "Just listen for now..."
      - "Let the sounds wash over you..."
      - "No need to repeat yet..."
      - "Getting you ready..."

  network_behavior:
    class: "network-faded"
    opacity: "Reduced to keep focus on message"

## ============================================================================
## INK SPIRIT REWARDS
## ============================================================================

INK_SPIRIT_REWARDS:
  description: "Target language congratulations that drift upward"
  philosophy: "Hidden formula - show results, not mechanics"

  languages:
    chinese: ["å¥½", "ä¸é”™", "å¾ˆå¥½", "å¯¹", "æ£’", "å‰å®³", "å¤ªæ£’äº†", "åŠ æ²¹"]
    italian: ["bene", "bravo", "perfetto", "ottimo", "cosÃ¬", "esatto", "fantastico"]
    spanish: ["bien", "muy bien", "genial", "perfecto", "excelente", "asÃ­", "eso"]
    welsh: ["da", "da iawn", "gwych", "ardderchog", "bendigedig"]

  animation:
    type: "Float upward and fade"
    trigger: "Hidden formula based on performance"

## ============================================================================
## COMPOSABLES
## ============================================================================

COMPOSABLES:
  useLearningSession:
    purpose: "Manage learning session state and progression"
    source: "packages/player-vue/src/composables/useLearningSession.ts"

  usePrebuiltNetworkIntegration:
    purpose: "Integrate constellation network with learning session"
    source: "packages/player-vue/src/composables/usePrebuiltNetworkIntegration.ts"

  useScriptCache:
    purpose: "Cache generated learning scripts"
    source: "packages/player-vue/src/composables/useScriptCache.ts"

  useMetaCommentary:
    purpose: "Manage intro messages and encouragements"
    source: "packages/player-vue/src/composables/useMetaCommentary.ts"

  useBeltProgress:
    purpose: "Track belt progression with localStorage + Supabase sync"
    source: "packages/player-vue/src/composables/useBeltProgress.ts"
    features:
      - "localStorage primary (instant, works offline)"
      - "Supabase background sync (cross-device)"
      - "max(local, remote) merge strategy"

  useBeltLoader:
    purpose: "Progressive loading with belt-aware priority queue"
    source: "packages/player-vue/src/composables/useBeltLoader.ts"
    features:
      - "Three-layer loading (blocking/background/infinite)"
      - "P0 blocking loads current belt first 5 rounds"
      - "P1-P5 background loads next belts breadth-first"
      - "Enables skip-ahead without blocking"

  useOfflinePlay:
    purpose: "Infinite play mode for offline resilience"
    source: "packages/player-vue/src/composables/useOfflinePlay.ts"
    features:
      - "Automatic online/offline detection"
      - "Shuffled playback from cached items"
      - "Recent item avoidance (no immediate repeats)"

  useLegoNetwork:
    purpose: "D3 force simulation for LEGO network (legacy)"
    source: "packages/player-vue/src/composables/useLegoNetwork.ts"

## ============================================================================
## CSS CUSTOM PROPERTIES
## ============================================================================

CSS_CUSTOM_PROPERTIES:
  theme:
    --bg-primary: "Deep space gradient"
    --text-primary: "#ffffff"
    --text-secondary: "#a0a0a0"
    --accent: "#c23a3a"

  belt_colors:
    --belt-color: "dynamic (from currentBelt)"
    --belt-glow: "dynamic"

  glass_effects:
    --glass-bg: "rgba(15, 15, 25, 0.8)"
    --glass-blur: "16px"
    --glass-border: "rgba(255, 255, 255, 0.1)"

## ============================================================================
## RESPONSIVE DESIGN
## ============================================================================

RESPONSIVE:
  breakpoints:
    mobile: "<= 480px"
    tablet: "481px - 768px"
    desktop: ">= 769px"

  adaptations:
    mobile:
      - "Larger text in hero pane"
      - "Touch-friendly node tap targets"
      - "Transport controls full width"
      - "Network zoomed out slightly for context"

    tablet:
      - "Standard text sizes"
      - "More network visible"

    desktop:
      - "Mouse wheel zoom support"
      - "Node hover tooltips"

## ============================================================================
## ACCESSIBILITY
## ============================================================================

ACCESSIBILITY:
  keyboard_navigation:
    space: "Play/pause"
    arrow_right: "Skip to next"
    arrow_left: "Go to previous"
    escape: "Exit session"

  screen_readers:
    aria_live: "Announce phase changes"
    aria_label: "Descriptive labels on controls and network"

## ============================================================================
## VERSION HISTORY
## ============================================================================

VERSION_HISTORY:
  v2.1.0:
    date: "2026-01-18"
    title: "Belt-Aware Progressive Loading"
    changes:
      - "Added useBeltLoader for progressive loading with priority queue"
      - "Added useOfflinePlay for infinite play when offline"
      - "Enhanced useBeltProgress with Supabase sync"
      - "Added highest_completed_seed as stable progress anchor"
      - "Added offline download UI in SettingsScreen"
      - "Updated belt system to use seed-based thresholds"

  v2.0.0:
    date: "2026-01-09"
    title: "Deep Space Constellation"
    changes:
      - "Replaced central card with ConstellationNetworkView"
      - "Replaced ring progress with phase strip (icons)"
      - "Added hero-centric glass pane"
      - "Added intro mode with typewriter display"
      - "Added transport controls in thumb zone"
      - "Replaced fireflies with star field"
      - "Added node tap playback"
      - "Added path animation during voice phases"

  v1.0.0:
    date: "2025-12-03"
    title: "Moonlit Dojo"
    features:
      - "Central card with ring progress"
      - "Phase dots"
      - "Firefly particles"
      - "Mountain silhouette background"

## ============================================================================
## GENERATED: 2026-01-18
## APML v2.1.0
## ============================================================================
